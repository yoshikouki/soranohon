# 本の挿絵エディタ

## 概要
`/books/[bookId]/edit` ルートで本の挿絵を作成、編集、生成する機能です。この機能により、シーンの挿絵を計画し、その計画に基づいて画像を生成することができます。

## 要件

### 1. リポジトリ層
- 挿絵計画のためのファイルシステムベースのリポジトリを実装
- 計画を `./plans/[bookId]/` ディレクトリに保存
- 各挿絵計画はYAMLフロントマター付きのマークダウンファイルとして保存
- 将来のデータベース移行のための詳細を抽象化するリポジトリパターン

### 2. 編集ページルート
- `/books/[bookId]/edit` に新しいルートを作成
- アクセス制御（現時点では開発専用）
- 参照用に既存の本のコンテンツを読み込む

### 3. 挿絵計画UI
- シーン選択インターフェース
- 挿絵要件を記述するためのフォーム
- 既存の挿絵のプレビュー
- 挿絵計画の保存/更新

### 4. 画像生成
- 画像生成のためのClaude APIとの統合
- `tools/illustration-automation/` の既存の `claude-api-client.js` を使用
- 生成された画像を適切な公開ディレクトリに保存
- リトライとエラー処理の実装

## データモデル

### 挿絵計画
```typescript
interface IllustrationPlan {
  id: string; // シーン識別子
  bookId: string; // 本の識別子
  description: string; // 画像生成のための詳細な説明
  prompt: string; // Claude用に生成またはカスタマイズされたプロンプト
  status: 'planned' | 'generated' | 'approved'; // ステータス追跡
  imageUrl?: string; // 生成された画像のURL（利用可能な場合）
  createdAt: Date;
  updatedAt: Date;
}
```

## 実装フェーズ

### フェーズ1（開発）
- ファイルシステムベースのリポジトリ実装
- 計画と生成のための基本UI
- 開発専用アクセス

### フェーズ2（将来）
- データベース移行
- ユーザー認証と認可
- ドラッグ＆ドロップ機能付きの高度なUI
- 一括生成機能

## 技術的考慮事項
- 不変データパターンの使用
- UIコンポーネントからビジネスロジックの分離
- 適切なエラー処理の実装
- パッケージ・バイ・フィーチャー組織の遵守
